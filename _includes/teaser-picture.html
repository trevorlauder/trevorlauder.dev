{%- comment -%}
Reusable responsive teaser <picture> component.
Parameters:
  name   (required) base filename without size or extension (e.g. "milky-way")
  alt    (optional) alt text (defaults to name)
  widths (optional) comma list; default 400,600,800,1200
  sizes  (optional) sizes attribute; default "(max-width: 760px) 100vw, 760px"
  class  (optional) CSS class for <picture>
Notes:
  Expects generated variants: name-W.ext in /assets/images/teasers/
  Falls back to original SVG/PNG if variants missing.
{%- endcomment -%}
{%- assign base = include.name -%}
{%- assign alt_text = include.alt | default: base -%}
{%- assign sizes_attr = include.sizes | default: '(max-width: 760px) 100vw, 760px' -%}
{%- assign teaser_path = '/assets/images/teasers/' -%}
{%- assign record = site.data.teasers[base] -%}
{%- comment -%} Determine widths. Prefer manifest; else param or default. {%- endcomment -%}
{%- if record and record.png and record.png.files -%}
  {%- assign widths = '' -%}
  {%- for f in record.png.files -%}
    {%- assign w = f | split: '.' | first | split: '-' | last -%}
    {%- assign widths = widths | append: w | append: ',' -%}
  {%- endfor -%}
  {%- assign widths = widths | split: ',' | uniq | sort -%}
{%- else -%}
  {%- assign widths = include.widths | default: '400,600,800,1200' | split: ',' -%}
{%- endif -%}
{%- assign probe = teaser_path | append: base | append: '-400.png' -%}
{%- assign probe_file = site.static_files | where: 'path', probe | first -%}
{%- if probe_file -%}
{%- comment -%} Precompute srcset attributes for avif, webp, and png {%- endcomment -%}
{%- capture avif_srcset -%}
  {%- if record and record.avif -%}
    {%- for f in record.avif.files -%}
      {{ teaser_path }}{{ f }} {{ f | split: '.' | first | split: '-' | last }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- else -%}
    {%- for w in widths -%}
      {{ teaser_path }}{{ base }}-{{ w | strip }}.avif {{ w | strip }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- endif -%}
{%- endcapture -%}
{%- capture webp_srcset -%}
  {%- if record and record.webp -%}
    {%- for f in record.webp.files -%}
      {{ teaser_path }}{{ f }} {{ f | split: '.' | first | split: '-' | last }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- else -%}
    {%- for w in widths -%}
      {{ teaser_path }}{{ base }}-{{ w | strip }}.webp {{ w | strip }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- endif -%}
{%- endcapture -%}
{%- capture png_srcset -%}
  {%- if record and record.png -%}
    {%- for f in record.png.files -%}
      {{ teaser_path }}{{ f }} {{ f | split: '.' | first | split: '-' | last }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- else -%}
    {%- for w in widths -%}
      {{ teaser_path }}{{ base }}-{{ w | strip }}.png {{ w | strip }}w{%- if forloop.last == false -%}, {% endif -%}
    {%- endfor -%}
  {%- endif -%}
{%- endcapture -%}
<picture class="{{ include.class | default: 'teaser-img' }}">
  <source type="image/avif" srcset="{{ avif_srcset | strip }}" sizes="{{ sizes_attr }}">
  <source type="image/webp" srcset="{{ webp_srcset | strip }}" sizes="{{ sizes_attr }}">
  <img loading="lazy" decoding="async"
       src="{{ teaser_path }}{{ base }}-800.png"
       srcset="{{ png_srcset | strip }}"
       sizes="{{ sizes_attr }}"
       width="1200" height="630" alt="{{ alt_text | escape }}">
</picture>
{%- else -%}
  {%- assign fallback_png = teaser_path | append: base | append: '.png' -%}
  {%- assign fallback_svg = teaser_path | append: base | append: '.svg' -%}
  {%- assign fallback_png_file = site.static_files | where: 'path', fallback_png | first -%}
  {%- assign fallback_svg_file = site.static_files | where: 'path', fallback_svg | first -%}
  {%- if fallback_png_file -%}
    <img class="{{ include.class | default: 'teaser-img' }}" src="{{ teaser_path }}{{ base }}.png" alt="{{ alt_text | escape }}">
  {%- elsif fallback_svg_file -%}
    <img class="{{ include.class | default: 'teaser-img' }}" src="{{ teaser_path }}{{ base }}.svg" alt="{{ alt_text | escape }}">
  {%- else -%}
    <img class="{{ include.class | default: 'teaser-img' }} teaser-img--missing"
         src="https://via.placeholder.com/1200x630?text=No+Image"
         alt="No image available for '{{ alt_text | escape }}'">
    <noscript><div class="teaser-img-missing-msg">No image available for '{{ alt_text | escape }}'</div></noscript>
  {%- endif -%}
{%- endif -%}
